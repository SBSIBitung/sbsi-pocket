<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SBSI Pocket - DPC Bitung</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <style>
        :root { --sbsi-red: #ed1c24; --sbsi-blue: #0056b3; --sbsi-dark: #2d3436; }
        body { background-color: #f4f7f6; font-family: 'Segoe UI', sans-serif; }
        .card-sbsi { border: none; border-top: 10px solid var(--sbsi-red); border-radius: 20px; max-width: 600px; margin: auto; }
        .btn-sbsi { background: var(--sbsi-red); color: white; border-radius: 12px; padding: 12px; font-weight: bold; border: none; }
        .btn-sbsi:hover { background: #c41217; }
        
        /* HEADER PDF STYLE */
        @media print {
            @page { margin: 0; }
            body { background: white; }
            .no-print { display: none !important; }
            .pdf-container { padding: 50px 60px; }
            .print-header { display: flex !important; align-items: center; border-bottom: 2.5px solid #000; padding-bottom: 15px; width: 100%; }
            .header-text { flex-grow: 1; white-space: nowrap; }
            .header-text h4 { color: var(--sbsi-blue) !important; font-size: 1.3rem; margin: 0; font-weight: 800; }
            .header-text .red-text { color: var(--sbsi-red) !important; margin: 0; font-weight: 700; }
            .header-text .black-text { color: #000 !important; margin: 0; font-weight: 700; }
            .doc-title { display: block !important; text-align: center; font-weight: bold; text-decoration: underline; margin-top: 20px; font-size: 1.4rem; text-transform: uppercase; }
        }

        .print-header, .doc-title, .print-footer { display: none; }
        .profile-img { width: 110px; height: 110px; object-fit: cover; border: 4px solid white; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        .hidden { display: none; }
    </style>
</head>
<body>

<div class="container mt-5">
    
    <div id="pageLogin" class="card card-sbsi shadow p-4 text-center">
        <img src="Logo_SBSI.png" width="100" class="mx-auto mb-3">
        <h4 class="fw-bold text-danger">SBSI POCKET LOGIN</h4>
        <div class="mt-4 text-start">
            <label class="small fw-bold">NIK KARYAWAN</label>
            <input type="text" id="inpNik" class="form-control mb-3" placeholder="Masukkan NIK">
            <label class="small fw-bold">PIN KEAMANAN</label>
            <input type="password" id="inpPin" class="form-control mb-4" placeholder="******">
            <button class="btn btn-sbsi w-100" onclick="handleLogin()">MASUK APLIKASI</button>
        </div>
    </div>

    <div id="pageDashboard" class="card card-sbsi shadow hidden overflow-hidden">
        <div class="bg-light p-4 text-center border-bottom">
            <img id="userFoto" src="" class="rounded-circle profile-img mb-3">
            <h4 id="userNama" class="fw-bold mb-0"></h4>
            <span id="userBadge" class="badge bg-danger rounded-pill"></span>
        </div>
        <div class="p-4">
            <div class="mb-3 border-bottom pb-2">
                <small class="text-muted d-block">NIK</small>
                <b id="dispNik"></b>
            </div>
            <div class="mb-3 border-bottom pb-2">
                <small class="text-muted d-block">Tempat, Tanggal Lahir</small>
                <b id="dispTtl"></b>
            </div>
            <div class="mb-4 border-bottom pb-2">
                <small class="text-muted d-block">Alamat</small>
                <b id="dispAlamat"></b>
            </div>

            <button class="btn btn-primary w-100 mb-2 fw-bold" onclick="showPage('pageAudit')">MULAI AUDIT HAK PEKERJA</button>
            <button id="btnAdmin" class="btn btn-dark w-100 mb-2 fw-bold hidden" onclick="loadAdminPanel()">PANEL MONITORING (OD)</button>
            <button class="btn btn-outline-secondary w-100 btn-sm" onclick="location.reload()">LOGOUT</button>
        </div>
    </div>

    <div id="pageAdmin" class="card card-sbsi shadow hidden p-4" style="max-width: 800px;">
        <h5 class="fw-bold text-danger mb-4 text-center">DATA SELURUH KARYAWAN</h5>
        <div class="table-responsive">
            <table class="table table-striped table-sm">
                <thead><tr><th>Nama</th><th>NIK</th><th>Role</th><th>Alamat</th></tr></thead>
                <tbody id="tableBodyAdmin"></tbody>
            </table>
        </div>
        <button class="btn btn-secondary w-100 mt-3" onclick="showPage('pageDashboard')">KEMBALI KE DASHBOARD</button>
    </div>

    <div id="pageAudit" class="card card-sbsi shadow hidden p-0 bg-white">
        <div class="pdf-container">
            <div class="print-header">
                <img src="Logo_SBSI.png" width="90" height="90" class="me-4">
                <div class="header-text">
                    <h4 class="text-uppercase">Federasi Serikat Buruh Sejahtera Indonesia</h4>
                    <div class="red-text">(FSBSI)</div>
                    <div class="black-text">DPC Kota Bitung</div>
                </div>
            </div>
            <div class="doc-title">Perhitungan Hak Buruh/Pekerja</div>

            <div class="p-4 no-print text-center border-bottom mb-3">
                <h5 class="fw-bold text-danger mb-0">INPUT DATA AUDIT</h5>
            </div>
            
            <div class="p-4">
                <div class="no-print">
                    <label class="small fw-bold mb-1">TANGGAL MULAI KERJA</label>
                    <input type="date" id="tglMulai" class="form-control mb-3">
                    <label class="small fw-bold mb-1">TANGGAL SELESAI KERJA (PHK)</label>
                    <input type="date" id="tglSelesai" class="form-control mb-4">
                    <button class="btn btn-danger w-100 p-3 fw-bold" onclick="alert('Proses Hitung...')">HITUNG KEKURANGAN HAK</button>
                    <button class="btn btn-link w-100 text-muted mt-2" onclick="showPage('pageDashboard')">Batal</button>
                </div>

                <div class="print-footer mt-5">
                    <table style="width: 100%;">
                        <tr>
                            <td style="width: 60%; vertical-align: bottom;">
                                <p class="small text-muted mb-0">
                                    Dokumen ini dicetak melalui Aplikasi SBSI Pocket<br>
                                    Dicetak pada: <span id="printDate"></span>
                                </p>
                            </td>
                            <td style="width: 40%; text-align: center;">
                                Bitung, ........................... 20....<br>Hormat Saya, Pekerja,<br><br><br><br>
                                <b>( <span id="signNama"></span> )</b>
                            </td>
                        </tr>
                    </table>
                </div>
            </div>
        </div>
    </div>

</div>

<script>
    const API_URL = "https://script.google.com/macros/s/AKfycby14nY3CRIId432pQUnRsAg-GKQOz-Z7JY2Ab9FZmUNDsedFVnoO1kfLmCk_SLYDobO/exec"; // GANTI DENGAN URL DEPLOY ANDA
    let currentUser = null;

    function showPage(id) {
        ['pageLogin', 'pageDashboard', 'pageAdmin', 'pageAudit'].forEach(p => {
            document.getElementById(p).classList.add('hidden');
        });
        document.getElementById(id).classList.remove('hidden');
    }

    async function handleLogin() {
        const nik = document.getElementById('inpNik').value;
        const pin = document.getElementById('inpPin').value;
        if(!nik || !pin) return alert("NIK & PIN Wajib diisi!");

        const resp = await fetch(API_URL, {
            method: 'POST',
            body: JSON.stringify({ action: "login", nik: nik, pin: pin })
        });
        const res = await resp.json();

        if(res.status === "success") {
            currentUser = res;
            // Isi Dashboard
            document.getElementById('userNama').innerText = res.user.nama;
            document.getElementById('userBadge').innerText = res.role;
            document.getElementById('userFoto').src = res.user.foto || 'https://via.placeholder.com/110';
            document.getElementById('dispNik').innerText = res.user.nik;
            document.getElementById('dispTtl').innerText = res.user.ttl;
            document.getElementById('dispAlamat').innerText = res.user.alamat;
            document.getElementById('signNama').innerText = res.user.nama;
            document.getElementById('printDate').innerText = new Date().toLocaleString('id-ID');

            // Jika OD, munculkan tombol panel
            if(res.role === "OD") {
                document.getElementById('btnAdmin').classList.remove('hidden');
            }

            showPage('pageDashboard');
        } else {
            alert(res.message);
        }
    }

    async function loadAdminPanel() {
        showPage('pageAdmin');
        const resp = await fetch(API_URL, {
            method: 'POST',
            body: JSON.stringify({ action: "getAllData" })
        });
        const res = await resp.json();
        const tbody = document.getElementById('tableBodyAdmin');
        tbody.innerHTML = '';
        res.data.forEach(u => {
            tbody.innerHTML += `<tr><td>${u.nama}</td><td>${u.nik}</td><td>${u.role}</td><td>${u.alamat}</td></tr>`;
        });
    }
</script>

</body>
</html>
